# 对战精灵自动战斗脚本

这是一个专为对战精灵游戏设计的自动战斗脚本，能够自动获取游戏窗口句柄，并在指定窗口内进行操作，无需全屏模式即可正常工作。

## 功能特点

- 自动获取游戏窗口句柄，支持自定义窗口标题
- 自动激活游戏窗口并在窗口内进行操作
- 智能检测战斗状态，自动处理战斗结果
- 支持多次连续自动战斗
- 提供测试功能，方便调试模板识别
- 自动选择圣物，优化战斗开局
- 智能购买和刷新卡牌，提高战斗效率
- 自动管理人口升级，优化资源分配
- 智能判断回合结束时机，自动进行回合切换

## 安装依赖

在使用前，请确保已安装所有必要的依赖库：

```
pip install -r requirements.txt
```

本脚本依赖以下库：
- opencv-python：用于图像处理和模板匹配
- numpy：用于数组操作
- pyautogui：用于模拟鼠标操作
- pillow：用于图像处理
- pywin32：用于获取窗口句柄和窗口操作

## 使用方法

### 1. 创建模板

首先需要创建游戏界面元素的模板图像，可以使用现有的模板创建工具：

```
python create_templates.py
```

按照提示创建以下必要的模板：
- battle_button.png：主界面的对战按钮
- confirm_battle.png：确认开始战斗的按钮
- victory_screen.png：胜利画面
- defeat_screen.png：失败画面
- ok_button.png：确认按钮
- card_slot_1.png ~ card_slot_4.png：卡牌槽位
- energy_full.png：能量满格指示
- gold_coin.png：金币图标
- refresh_cost.png：刷新卡牌按钮
- population.png：人口图标
- buy_card.png：购买卡牌按钮

### 2. 运行自动战斗

创建完模板后，运行自动战斗脚本：

```
python run_auto_battle_spirit.py
```

在菜单中选择「开始自动战斗」，输入游戏窗口标题（默认为"对战精灵"）和想要进行的战斗次数，脚本会自动查找游戏窗口并开始自动战斗。

### 3. 测试功能

脚本提供了两个测试功能：

- 测试窗口句柄获取：检查是否能正确获取游戏窗口
- 测试模板识别：测试各个模板是否能被正确识别

## 自定义

您可以通过修改`auto_battle_spirit.py`文件中的战斗策略来自定义机器人的行为。主要可以修改的部分包括：

- `perform_battle_actions`方法：定义战斗中的操作逻辑
- `play_card`方法：定义如何打出卡牌和选择目标位置
- `detect_energy`方法：定义如何检测当前能量值
- `select_relic`方法：定义如何选择圣物
- `buy_card`方法：定义如何购买卡牌
- `refresh_shop`方法：定义何时刷新卡牌商店
- `upgrade_population`方法：定义何时升级人口上限

## 故障排除

1. 如果脚本无法找到游戏窗口，请确保：
   - 游戏已经启动
   - 输入的窗口标题正确（可以尝试输入窗口标题的一部分）

2. 如果模板识别不准确，请尝试：
   - 重新创建更清晰的模板
   - 调整置信度参数（默认为0.7）

3. 如果点击操作不准确，请确保：
   - 游戏窗口没有被遮挡
   - 游戏界面与创建模板时的界面一致

## 注意事项

- 使用脚本时，请不要移动鼠标或进行其他操作，以免干扰脚本运行
- 脚本运行过程中，可以按Ctrl+C随时中断
- 本脚本仅用于学习和研究目的，请勿用于商业用途